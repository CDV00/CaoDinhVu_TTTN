@model Entities.DTOs.AddProductItem

@{
    ViewData["Title"] = "product item";
    Layout = "~/Areas/Admin/Views/Share/_layoutAdmin.cshtml";

}
<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
        @@keyframes spin {
            0% {
                transform: rotate(0);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1003;
            @*background: #ffffff;*@
            overflow: hidden;
        }

            .spinner div:first-child {
                display: block;
                position: relative;
                left: 50%;
                top: 50%;
                width: 150px;
                height: 150px;
                margin: -75px 0 0 -75px;
                border-radius: 50%;
                box-shadow: 0 3px 3px 0 rgba(255, 56, 106, 1);
                transform: translate3d(0, 0, 0);
                animation: spin 2s linear infinite;
            }

                .spinner div:first-child:after,
                .spinner div:first-child:before {
                    content: "";
                    position: absolute;
                    border-radius: 50%;
                }

                .spinner div:first-child:before {
                    top: 5px;
                    left: 5px;
                    right: 5px;
                    bottom: 5px;
                    box-shadow: 0 3px 3px 0 rgb(255, 228, 32);
                    -webkit-animation: spin 3s linear infinite;
                    animation: spin 3s linear infinite;
                }

                .spinner div:first-child:after {
                    top: 15px;
                    left: 15px;
                    right: 15px;
                    bottom: 15px;
                    box-shadow: 0 3px 3px 0 rgba(61, 175, 255, 1);
                    animation: spin 1.5s linear infinite;
                }
</style>
<style>
    select {
        font-family: fontAwesome
    }
</style>
<link href="~/css/color.css" rel="stylesheet" />
<section id="AddproductItemss" class="content m-5 w-sm-100 pb-5">
    <div class="mb-3">
        <span>Tên sản phẩm: @Model.Product.Name</span>
        <br />
        <br />
        <img src="@Model.Product.Thumbnails" alt="ảnh sản phẩm" class="img-fluid" style="width:150px" />
    </div>


    <input hidden type="text" name="custom_color" id="Product" value="@Model.Product.Id">
    <input hidden type="text" name="custom_color" id="ProductColor" value="1">
    <!--Chọn màu sắc và thêm product option-->
    <div class="input-group mb-3">
        <div id="a" class="input-group-prepend">
            <label class="input-group-text" for="inputGroupSelect01">Chọn màu sắc cho sản phẩm</label>
        </div>
        <select class="custom-select" id="Color">
            <option value="1">Chọn màu sắc</option>
            @foreach (var item in Model.Colors)
            {
                if (item.Hex.ToString() == "#000000")
                {
                    <option class="text-white" style="background:@item.Hex; opacity: 0.2;" value="@item.Id" data-hex="@item.Hex"> @item.Name</option>
                }
                else
                {
                    <option style="background:@item.Hex; opacity: 0.2; color:#000000" value="@item.Id"> @item.Name </option>
                }

            }
            <option value="0">Màu sắc khác</option>
        </select>
    </div>


    <!--Thêm màu sắc-->
    <div class="border w-lg-50 w-sm-100 mb-5" id="addcolor" style="background: #EFF5F5;">
        @*<div class="mb-3 mt-3">
            <label for="uname" class="form-label">Tên màu</label>
            <input type="text" class="form-control" id="NameColor" placeholder="Enter username" name="uname" required>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please fill out this field.</div>
        </div>*@
        <label class="form-label ml-3">Tên màu</label>
        <input id="NameColor" type="text" /><br />
         
        <div class="row mt-3 ml-3">
            <div class="col-2">
                <label>Chọn màu</label>
            </div>
            <div class="col-3 color-wrapper">
            
            <!-- <p>Choose color (#hex)</p> -->
            <input type="text" name="custom_color" placeholder="#ffffff" id="pickcolor" class="call-picker">
            <div class="color-holder call-picker"></div>
            <div class="color-picker" id="color-picker" style="display: none; z-index: 5; "></div>
        </div>
        </div>
         
        
        <br />
        <br />
        <div claas="float-end" style="background: #EFF5F5;">
            <div class="btn btn-danger ml-3" id="AnThem">Ẩn thêm color </div>
            <div class="btn btn-success" id="themMau">Thêm color </div>
        </div>

    </div>


    <!-- chọn option và Thêm product option-->
    <div class="border w-lg-50 w-sm-100 " id="options" style="background: #EFF5F5;">
        <!--Chọn option-->
        <div class="input-group mb-3">
            <div id="a" class="input-group-prepend">
                <label class="input-group-text" for="inputGroupSelect01">Chọn phiên bản cho sản phẩm</label>
            </div>
            <select class="custom-select" id="option">
                <option value="1">Chọn Option</option>
                @foreach (var item in Model.Options)
                {
                    <option value="@item.Id"> @(item.RAM)/@(item.ROM)</option>
                }
                <option value="0">Màu Option</option>
            </select>
        </div>
        <!--End Chọn option-->
        <!--Thêm option-->
        <div class="border w-lg-50 w-sm-100 mb-5" id="addoption" style="background: #CFFDE1;">
            <div class="input-group mb-3">
                <!--Dung lượng ram-->
                <div class="input-group-prepend ml-5">
                    <span class="input-group-text">Dung lượng RAM</span>
                </div>
                <input id="RAM" type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
                <div class="input-group-append">
                    <span class="input-group-text">GB</span>
                </div>
                <!--Dung lượng rom-->
                <div class="input-group-prepend ml-5">
                    <span class="input-group-text">Dung lượng ROM</span>
                </div>
                <input id="ROM" type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
                <div class="input-group-append">
                    <span class="input-group-text">GB</span>
                </div>
            </div>
            <div class="btn btn-success ml-3 float-right" id="ThemOption">Thêm option </div>
            <div class="btn btn-danger float-right" id="anThemOption">Ẩn thêm option </div>
        </div>
        <!--End Thêm option-->
        <!--form thêm product option-->
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <button class="btn btn-outline-secondary " type="button" id="button-addon1">Số lượng trong kho</button>
            </div>
            <input id="SoLuong" type="text" class="form-control" placeholder="" aria-label="Example text with button addon" aria-describedby="button-addon1">

            <div class="input-group-prepend ml-5">
                <span class="input-group-text">Giá bán</span>
            </div>
            <input id="giaban" type="text" class="form-control" aria-label="Amount (to the nearest dollar)">
            <div class="input-group-append">
                <span class="input-group-text">VND</span>
            </div>

        </div>
        <div class="btn btn-success ml-3 float-right" id="AddProductOption">Thêm sản phẩm</div>
        <div class="btn btn-danger float-right" id="clearForm">clear Form </div>

    </div>
</section>





@section footer{
    @*<link href="https://cdn.jsdelivr.net/npm/@@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>*@
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        $(document).ready(function () {
            //
            $("#addcolor").hide();
            $("#addoption").hide();
            $('#options').hide();
            @*$('#themMau').click(function () {
                $("#addcolor").show();
            });*@
            //xử lý ẩn add corlor
            $('#AnThem').click(function () {

                $('#Color').val("1").change();
            });
            //xử lý change color và add ProductColor
            $(document).on('change', '#Color', function () {
                var valueColor = $(this).val();
                if (valueColor == "0") {
                    $('#options').hide();
                    $("#addcolor").show();
                }
                else if (valueColor == "1") {
                    $('#options').hide();
                    $("#addcolor").hide();
                }
                else {
                    $("#addcolor").hide();
                    //
                    $("#AddproductItemss").append(
                        "<div class='spinner'></div>"
                    );
                    $(".spinner").append(

                        "<div class='blob blob-0'></div>",
                    );
                    //
                    var productColor = {
                        "ColorId": valueColor,
                        "ProductId": $("#Product").val()
                    };
                    console.log(JSON.stringify(productColor));
                    $.ajax({
                        url: '/Admin/Products/AddProductCorlor',
                        type: "post",
                        contentType: "application/json",
                        data: JSON.stringify(productColor),
                        success: function (res) {
                            var obj = JSON.parse(res);
                            if (obj.IsSuccess) {
                                var ProductColorId = obj.Message;
                                $("#ProductColor").val(ProductColorId);


                                Swal.fire({
                                    position: 'top-end',
                                    icon: 'success',
                                    title: 'Hoàn Thành',
                                    showConfirmButton: false,
                                    timer: 1500
                                })

                                $('#options').show();
                                $(".spinner").remove();
                            }

                        }
                    })

                }
            });

            //ẩn thêm option
            $('#anThemOption').click(function () {
                $('#option').val("1").change();
            });
            //xử lý change option
            $(document).on('change', '#option', function () {
                var valueOption = $(this).val();
                if (valueOption == "0") {

                    $("#addoption").show();
                }
                else if (valueOption == "1") {
                    $("#addoption").hide();
                }
            });
            //Add color
            $('#themMau').click(function () {
                //
                $("#AddproductItemss").append(
                    "<div class='spinner'></div>"
                );
                $(".spinner").append(

                    "<div class='blob blob-0'></div>",
                );
                //
                var color = {
                    "Name": $("#NameColor").val(),
                    "Hex": $("#pickcolor").val()
                };
                $.ajax({
                    url: '/Admin/Products/AddColor',
                    //data: { categoryId: $(this).data('id') },
                    async: true,
                    type: "post",
                    contentType: "application/json",
                    data: JSON.stringify(color),
                    success: function (res) {
                        var obj = JSON.parse(res);
                        console.log(obj);
                        if (obj.IsSuccess == true) {
                            //thông báo
                            @*swalWithBootstrapButtons.fire(
                                'Thành công!',
                                'Bạn đã xóa thương hiệu thành công.',
                                'success'
                            );*@
                            $("#Color").empty();
                            let DS = "";
                            $("#Color").append("<option value='1'>Chọn màu sắc</option>");
                            $.each(obj.Data, function () {
                                console.log($(this));
                                DS += $(this)[0].Name;
                                DS += $(this)[0].Hex;
                                DS += $(this)[0].Id;

                                if ($(this)[0].Hex == "#000000") {
                                    $("#Color").append(`<option class="text-white" style="background:${$(this)[0].Hex};" value="${$(this)[0].Id}" data-hex="${$(this)[0].Hex}"> ${$(this)[0].Name}</option>`);
                                }
                                else {
                                    $("#Color").append(`<option style="background:${$(this)[0].Hex};" value="${$(this)[0].Id}" data-hex="${$(this)[0].Hex}"> ${$(this)[0].Name}</option>`);
                                }
                            });
                            $("#Color").append("<option value='0'>Màu sắc khác</option>");

                            $('#Color').val("1").change();
                            Swal.fire({
                                position: 'top-end',
                                icon: 'success',
                                title: 'Hoàn Thành',
                                showConfirmButton: false,
                                timer: 1500
                            })


                            $(".spinner").remove();
                        }

                    }
                })
            });
            //Add option
            $('#ThemOption').click(function () {
                //
                $("#AddproductItemss").append(
                    "<div class='spinner'></div>"
                );
                $(".spinner").append(

                    "<div class='blob blob-0'></div>",
                );
                //
                var option = {
                    "RAM": $("#RAM").val(),
                    "ROM": $("#ROM").val()
                };
                $.ajax({
                    url: '/Admin/Products/AddOption',
                    async: true,
                    type: "post",
                    contentType: "application/json",
                    data: JSON.stringify(option),
                    success: function (res) {

                        var obj = JSON.parse(res);
                        if (obj.IsSuccess == true) {
                            $("#option").empty();
                            let DS = "";
                            $("#option").append("<option value='1'>Chọn option</option>");
                            $.each(obj.Data, function () {
                                console.log($(this));
                                DS += $(this)[0].RAM;
                                DS += $(this)[0].ROM;
                                DS += $(this)[0].Id;
                                $("#option").append(`<option value="${$(this)[0].Id}"> ${$(this)[0].RAM}/${$(this)[0].ROM}</option>`);
                            });
                            $("#option").append("<option value='0'>Thêm option</option>");

                            $('#option').val("1").change();
                            Swal.fire({
                                position: 'top-end',
                                icon: 'success',
                                title: 'Hoàn Thành',
                                showConfirmButton: false,
                                timer: 1500
                            })
                            $(".spinner").remove();
                        }
                    }
                })
            });
            //clearForm Product option
            $('#clearForm').click(function () {
                $('#giaban').val("");
                $('#SoLuong').val("");
            });
            //Add Product option
            $('#AddProductOption').click(function () {
                //
                $("#AddproductItemss").append(
                    "<div class='spinner'></div>"
                );
                $(".spinner").append(

                    "<div class='blob blob-0'></div>",
                );
                //
                var optionId = $('#option').find(":selected").val();

                var productOption = {
                    "Number": $("#SoLuong").val(),
                    "ProductColorId": $("#ProductColor").val(),
                    "ProductId": $("#Product").val(),
                    "OptionId": optionId,
                    "Price": $("#giaban").val()
                };
                $.ajax({
                    url: '/Admin/Products/AddProductOption',
                    async: true,
                    type: "post",
                    contentType: "application/json",
                    data: JSON.stringify(productOption),
                    success: function (res) {
                        var obj = JSON.parse(res);
                        if (obj.IsSuccess == true) {
                            $('#AddProductOption').before("<strong class='text-succes' >Thêm sản phẩm thành công</strong>");
                            $('#giaban').val("");
                            $('#SoLuong').val("");
                            $('#option').val("1").change();
                        }
                        else {
                            $('#AddProductOption').before("<strong class='text-danger' >Thêm sản phẩm thành công</strong>");
                        }
                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Hoàn Thành',
                            showConfirmButton: false,
                            timer: 1500
                        })


                        $(".spinner").remove();

                    }
                })
            });
        });
    </script>
    <!-- script chọn color-->
    @*<script src="http://code.jquery.com/jquery-latest.min.js"></script>*@
    <!--Xử lý chọn corlor khi muốn thêm color mới-->
    <script>
        var colorList = ['000000', '993300', '333300', '003300', '003366', '000066', '333399', '333333',
            '660000', 'FF6633', '666633', '336633', '336666', '0066FF', '666699', '666666',
            'CC3333', 'FF9933', '99CC33', '669966', '66CCCC', '3366FF', '663366', '999999',
            'CC66FF', 'FFCC33', 'FFFF66', '99FF66', '99CCCC', '66CCFF', '993366', 'CCCCCC',
            'FF99CC', 'FFCC99', 'FFFF99', 'CCffCC', 'CCFFff', '99CCFF', 'CC99FF', 'FFFFFF'];

        var picker = $('#color-picker');

        for (var i = 0; i < colorList.length; i++) {
            picker.append('<li class="color-item" data-hex="' +
                '#' + colorList[i] + '" style="background-color:' +
                '#' + colorList[i] + ';"></li>');
        }
        // khi click vao bang mau, no se tu mat
        $('body').click(function () {
            picker.fadeOut();
        });

        // click de xuat hien bang mau
        $('.call-picker').click(function (event) {
            event.stopPropagation();
            picker.fadeIn();
            picker.children('li').hover(function () {
                var codeHex = $(this).data('hex');
                $('.color-holder').css('background-color', codeHex);
                $('#pickcolor').val(codeHex);

            });
        });


    </script>

}

